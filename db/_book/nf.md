# 数据库的三范式

为了建立冗余较小、结构合理的数据库，设计数据库时必须遵循一定的规则。在关系型数据库中这种规则就称为范式。

## 第一范式（1NF）

保证列的原子性，即列的信息不能再分解，列不能是数组或集合。关系型数据库自然满足第一范式。

此外，如果在实际场景中，列中数据可以继续拆分，也应当拆分成多个列。

比如，需求要按大致地址对用户分类，那么就可以将地址列拆分成：省、市、详细地址三列。需求要按用户的姓氏和另外的性别列来称呼‘‘xx先生/女士’’，就可以将姓名列拆分成姓氏、名字两列。

## 第二范式（2NF）

第二范式在第一范式的基础上，要求表中的每一行都被唯一的区分，即保证主键唯一。选择一个保证互不相同的列（比如，身份证号，学号等），或自增行号，作为主键。

如果用多个列组成联合主键，不能存在一个非主键列，只依赖与其中一个主键列。应当继续拆分表。

比如，学生选课表（<u>学号，课程</u>，成绩，课程学分）：其中（学号，课程）作为主键，但课程学分列则只依赖于课程列。这样就存在部分依赖的问题，是不符合第二范式的。

可以拆分成两个表：学生选课表（<u>学号，课程</u>，成绩），课程信息表（<u>课程</u>，课程学分）。这样就不存在部分依赖的问题了。

## 第三范式（3NF）

第三范式在第二范式的基础上，要求一个表中不能包含已在其他表中已包含的非主键列。为了满足第三范式，往往要把表拆分成多个表，需要时再join。

另外一层表述是，属性间不能存在传递关系。如果某一属性依赖于其他非主键属性，而其他非主键属性又依赖于主键，那么这个属性就是间接依赖于主键的。第三范式要求表中每个属性都与主键直接依赖，不能出现间接依赖。实际上，重复的非主键列也是一种间接依赖。

比如：图书馆中有：

```markdown
借书记录表（记录号，书编号，用户号，书名，会员等级）
用户表（用户号，电话，会员等级，会员权限，过期时间）
```

可以看出，借书记录表中会员等级是重复列，而且也存在间接依赖：记录号->书编号->书名，记录号->用户号会员->等级。应该拆分表：

```
借书记录表（记录号，书编号，用户号）
书表（书编号，书名）
用户表（用户号，电话，会员等级，会员权限，过期时间）
```

继续观察发现，用户表中存在间接依赖：用户号->会员等级->会员权限，应该继续拆分：

```
借书记录表（记录号，书编号，用户号）
书表（书编号，书名）
用户表（用户号，电话，会员等级，过期时间）
会员等级表（会员等级，会员权限）
```

直到满足第三范式。

## 总结

三大范式只是一般设计数据库的基本理念，可以建立冗余较小、结构合理的数据库。没有冗余的数据库未必是最好的数据库。有时为了提高运行效率，提高读性能，就必须降低范式标准，适当保留冗余数据。具体做法是： 在概念数据模型设计时遵守第三范式，降低范式标准的工作放到物理数据模型设计时考虑。降低范式就是增加字段，减少了查询时的关联，提高查询效率，因为在数据库的操作中查询的比例要远远大于DML的比例。但是反范式化一定要适度，并且在原本已满足三范式的基础上再做调整的。