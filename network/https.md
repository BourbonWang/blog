# HTTP 与 HTTPS

## HTTP

HTTP是超文本传输协议的缩写，是一个基于请求与响应，无状态的，应用层的协议，常基于TCP/IP协议传输数据，互联网上应用最为广泛的一种网络协议，所有的WWW文件都必须遵守这个标准。设计HTTP的初衷是为了提供一种发布和接收HTML页面的方法。随着发展，HTTP可以支持传输任何类型的数据。

## 特点

### 基于请求和响应

HTTP协议一般用于B/S架构，浏览器向服务端发送请求报文，服务器解析后，将数据包含在响应报文中，发送给浏览器。

### 无状态

协议对事务处理没有记忆能力，后续处理如果需要之前的信息，则必须重传。比如访问一个网站需要反复进行登录操作。对于这个特点，现有的一些解决方案比如

* 利用 Cookie / Session
* HTTP/1.1持久连接（HTTP keep-alive）。只要任意一端没有明确提出断开连接，则保持TCP连接状态，在请求首部字段中的Connection: keep-alive即为表明使用了持久连接

这样可以让用户在登陆后一段时间内不需要再次登陆。

### 无连接

由于无状态特点，每次请求需要通过TCP三次握手四次挥手，和服务器重新建立连接。当一个用户与服务器进行频繁的请求时，建立TCP连接将耗费大量的开销。

为此，HTTP/1.1 支持了长连接，与同一个用户的多次数据传输可以使用同一个TCP信道。但对一个信道的多个请求存在排队，不支持同时处理多个HTTP连接。

HTTP/2.0在其上实现了多路复用，对于同时的多个请求，可以同时在信道上发送和接收，大幅缩短资源请求的耗时，在请求大数量资源时效果显著。

### 简单快速、灵活

客户向服务器请求服务时，只需传送请求方法和路径。HTTP允许传输任意类型的数据对象。传输的类型由Content-Type加以标记。

## 存在的问题

- 请求信息明文传输，容易被窃听截取。
- 数据的完整性未校验，容易被篡改。
- 没有验证对方身份，存在冒充危险。

## HTTPS

为了解决上述HTTP存在的问题，就用到了HTTPS。HTTPS是一种通过计算机网络进行安全通信的传输协议，经由HTTP进行通信，利用SSL/TLS建立全信道，加密数据包。HTTPS使用的主要目的是提供对网站服务器的身份认证，同时保护交换数据的隐私与完整性。

### 加密

发送方随机生成密钥对消息进行对称加密。使用接收方的公钥加密对称密钥，仅有接收方可以解密，从而得到对称密钥解出明文。任何中间人无法得到接收方的私钥，也就无法破解消息。

### 数字摘要

对消息进行哈希，得到固定长度的唯一的码，不同消息的哈希码不同，将此哈希码一同发送给接收方，用于消息验证。接收方用同样的哈希函数对收到的明文进行哈希，与收到的哈希码比较，从而可以判断消息是否完整或被更改。由于哈希函数本身保证了无法从哈希码反推出明文，因此可以保证数字摘要是可靠的。

### 数字签名

验证消息是否真实来自发送方，也可以认为是验证数字摘要是否真实来自发送方。发送方用发送方的私钥对数字摘要进行加密。这样仅能用发送方的公钥进行解密，中间人无法进行伪造。

## 过程

1. 首先客户端通过URL访问服务端443端口请求建立SSL连接。包括加密协议，版本，随机数1等等
2. 服务端选择合适的加密协议，产生随机数2, 返回客户端
3. 服务端随即发送CA证书，其中包含了服务端的公钥。
4. 客户端验证证书。生成一个随机数，即预主密钥。
5. 客户端通过随机数1,随机数2,预主密钥组合成会话密钥。用服务端的公钥进行加密
6. 服务端收到后用私钥解密，同样的方式组装出会话密钥。
7. 服务端用会话密钥加密一条消息发送回客户端，用来验证是否得到了正确的会话密钥。
8. 客户端同样用会话密钥加密一条消息，用来告诉服务端消息可以正常接收。
9. SSL连接建立完成。

## 不足

### 安全性

* HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用
* SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行

### 成本

- SSL证书需要购买，功能越强大的证书费用越高
- HTTPS协议多次握手，会使页面的加载时间延长近50%，增加耗电。比较好的方式是采用分而治之，网站主页使用HTTP协议，有关于用户信息等方面使用HTTPS。
- HTTPS连接缓存不如HTTP高效，流量成本高。
- SSL涉及到的安全算法会消耗 CPU 资源，对服务器资源消耗较大。